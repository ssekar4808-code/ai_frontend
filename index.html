<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI PDF Summarizer ‚Äî Final Fixed</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root{
      --accent1:#8b5cf6; --accent2:#06b6d4; --muted:#9fb2d9;
    }
    body{
      margin:0;font-family:"Poppins",sans-serif;color:#eef2ff;
      background:linear-gradient(135deg,#111827,#0f172a,#1e3a8a);
      background-size:400% 400%;animation:bgShift 20s ease infinite;
      padding:30px;text-align:center;
    }
    @keyframes bgShift{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    h1{font-size:2.2em;background:linear-gradient(90deg,var(--accent1),var(--accent2));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 0 20px rgba(139,92,246,0.4)}
    .card{
      background:rgba(255,255,255,0.08);backdrop-filter:blur(10px);
      border-radius:16px;padding:20px;margin:20px auto;
      box-shadow:0 8px 32px rgba(0,0,0,0.3);max-width:800px;text-align:left;
    }
    button{
      background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;
      color:white;font-weight:bold;border-radius:10px;padding:10px 18px;margin:6px;
      cursor:pointer;transition:.3s;
    }
    button:hover{transform:scale(1.05);box-shadow:0 0 12px rgba(139,92,246,0.6)}
    input[type=file]{background:#fff;color:#111;border-radius:8px;padding:6px;margin-top:10px}
    .progress{width:100%;background:rgba(255,255,255,0.15);height:8px;border-radius:8px;margin-top:10px;overflow:hidden;display:none}
    .progress div{height:8px;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width .3s}
    .result{margin-top:10px;padding:12px;background:rgba(255,255,255,0.1);
      border-radius:10px;white-space:pre-wrap;min-height:120px;color:#e2e8f0}
    .orb{position:fixed;bottom:40px;right:40px;width:60px;height:60px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%,#8b5cf6,#4c1d95);
      box-shadow:0 0 50px #8b5cf6;display:flex;align-items:center;justify-content:center;
      color:#fff;font-weight:bold;animation:float 3s ease-in-out infinite;}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
    footer{color:#9ca3af;font-size:13px;margin-top:20px}
    .history-item{display:flex;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,0.1);padding:6px 0}
  </style>
</head>
<body>
  <h1>üìÑ AI PDF Summarizer</h1>
  <p>Upload your PDF & let AI summarize it in seconds</p>

  <div class="card">
    <input type="file" id="pdfFile" accept="application/pdf" />
    <button id="summarizeBtn">‚ö° Summarize</button>
    <div class="progress" id="progress"><div></div></div>
  </div>

  <div class="card">
    <h2>üß† Summary</h2>
    <div id="result" class="result">No summary yet.</div>
    <div>
      <button id="shortBtn">‚úÇÔ∏è Shorten</button>
      <button id="expandBtn">üîç Expand</button>
      <button id="voiceBtn">üó£ Speak</button>
      <button id="stopVoiceBtn">üõë Stop</button>
      <button id="copyBtn">üìã Copy</button>
      <button id="downloadBtn">üíæ Download</button>
    </div>
  </div>

  <div class="card">
    <h2>üìú History</h2>
    <div id="historyList"></div>
  </div>

  <div class="orb" id="orb">AI</div>

  <footer>¬© 2025 AI Summarizer ‚Äî Polished Version</footer>

  <script>
    const BACKEND_URL = "https://ai-backend-9oul.onrender.com";
    const fileInput = document.getElementById("pdfFile");
    const resultDiv = document.getElementById("result");
    const progressBar = document.getElementById("progress");
    const progressInner = progressBar.querySelector("div");
    const synth = window.speechSynthesis;
    let currentSummary = "";
    let speaking = false;

    const orb = document.getElementById("orb");
    function orbSpeak(msg){
      orb.textContent = "üí¨";
      setTimeout(()=>orb.textContent="AI",1200);
      console.log("[ORB]",msg);
    }

    document.getElementById("summarizeBtn").addEventListener("click", async () => {
      const file = fileInput.files[0];
      if (!file) return alert("Please select a PDF file first!");
      orbSpeak("Analyzing...");
      const formData = new FormData();
      formData.append("file", file);

      progressBar.style.display="block";
      progressInner.style.width="0%";
      let width=0;
      const interval=setInterval(()=>{
        if(width<90){width+=10;progressInner.style.width=width+"%";}
      },300);

      try{
        const res = await fetch(`${BACKEND_URL}/summarize`,{method:"POST",body:formData});
        clearInterval(interval);
        progressInner.style.width="100%";
        setTimeout(()=>progressBar.style.display="none",400);
        const data = await res.json();
        currentSummary = data.summary || "No summary generated.";
        resultDiv.innerText = "";
        typeWriter(currentSummary);
        orbSpeak("Summary ready!");
        addHistory(file.name, currentSummary);
      }catch(err){
        clearInterval(interval);
        alert("Error: "+err.message);
        progressBar.style.display="none";
      }
    });

    function typeWriter(text,i=0){
      if(i<text.length){
        resultDiv.innerText += text.charAt(i);
        setTimeout(()=>typeWriter(text,i+1),8);
      }
    }

    // Shorten / Expand
    document.getElementById("shortBtn").onclick=()=>{
      if(!currentSummary)return;
      const sents=currentSummary.split(/[.?!]/).filter(x=>x.trim().length>5);
      const short=sents.slice(0,Math.max(2,Math.ceil(sents.length/3))).join(". ")+".";
      resultDiv.innerText=short;
    };
    document.getElementById("expandBtn").onclick=()=>{
      if(!currentSummary)return;
      resultDiv.innerText=currentSummary+"\n\nIn simpler terms: "+currentSummary;
    };

    // Voice
    document.getElementById("voiceBtn").onclick=()=>{
      if(!currentSummary)return;
      if(speaking)synth.cancel();
      const utter=new SpeechSynthesisUtterance(currentSummary);
      utter.rate=1; utter.pitch=1;
      speaking=true; utter.onend=()=>speaking=false;
      synth.speak(utter);
    };
    document.getElementById("stopVoiceBtn").onclick=()=>{
      synth.cancel(); speaking=false;
    };

    // Copy / Download
    document.getElementById("copyBtn").onclick=()=>{
      if(!currentSummary)return;
      navigator.clipboard.writeText(resultDiv.innerText);
      orbSpeak("Copied!");
    };
    document.getElementById("downloadBtn").onclick=()=>{
      if(!currentSummary)return;
      const blob=new Blob([resultDiv.innerText],{type:"text/plain"});
      const a=document.createElement("a");
      a.href=URL.createObjectURL(blob);
      a.download="summary.txt";
      a.click();
    };

    // History system
    function addHistory(name,text){
      const history = JSON.parse(localStorage.getItem("pdfHistory")||"[]");
      history.unshift({name,time:new Date().toLocaleString(),text});
      localStorage.setItem("pdfHistory",JSON.stringify(history));
      renderHistory();
    }
    function renderHistory(){
      const history = JSON.parse(localStorage.getItem("pdfHistory")||"[]");
      const div=document.getElementById("historyList");
      div.innerHTML="";
      if(history.length===0){div.innerHTML="<em>No summaries yet.</em>";return;}
      history.forEach(h=>{
        const item=document.createElement("div");
        item.className="history-item";
        const info=document.createElement("div");
        info.innerHTML=`<strong>${h.name}</strong> - <small>${h.time}</small>`;
        const btn=document.createElement("button");
        btn.textContent="View";
        btn.onclick=()=>{
          resultDiv.innerText=h.text||"";
          currentSummary=h.text||"";
        };
        item.appendChild(info);item.appendChild(btn);
        div.appendChild(item);
      });
    }
    renderHistory();
  </script>
</body>
</html>
